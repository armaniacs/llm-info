# プロダクトバックログ: llm-info テスト修正

## ビジョン
すべてのテストが安定してパスし、リリース品質を担保する

## バックログアイテム

### PBI-001: E2Eテストのフラグ名不一致を修正
**ストーリー**: テスト実行者として、正しいフラグ名でテストが実行できるようにしたい
**優先度**: High
**ステータス**: 未着手
**ポイント**: 3

**受入条件**:
- [ ] すべてのE2Eテストで `-output` が `--format` に修正されている
- [ ] テストが実行時にフラグエラーを発生させない
- [ ] JSON出力関連のテストがパスする

**技術的タスク**:
- `test/e2e/advanced_display_test.go` の修正
- `test/e2e/display_workflow_test.go` の修正
- その他関連ファイルでの置換実施

**依存関係**: なし

---

### PBI-002: 設定優先順位の実装を修正
**ストーリー**: ユーザーとして、CLI引数が環境変数を正しく上書きしてほしい
**優先度**: High
**ステータス**: 未着手
**ポイント**: 5

**受入条件**:
- [ ] TestConfigPriority/partial_CLI_override がパス
- [ ] TestConfigSourceInfo がパス
- [ ] CLI引数、環境変数、設定ファイルの優先順位が正しく動作
- [ ] 設定ソース情報が正しく表示される

**技術的タスク**:
- `internal/config/manager.go` の ResolveConfig メソッド調査
- 設定マージロジックの実装修正
- `test/integration/env_priority_test.go` の修正

**依存関係**: なし

---

### PBI-003: 設定検証ロジックを修正
**ストーリー**: ユーザーとして、無効な設定値に対して適切なエラーが表示されてほしい
**優先度**: Medium
**ステータス**: 未着手
**ポイント**: 3

**受入条件**:
- [ ] TestConfigValidation/invalid_URL がパス
- [ ] TestEnvironmentVariableValidation/invalid_timeout がパス
- [ ] TestEnvironmentVariableValidation/invalid_output_format がパス
- [ ] エラーメッセージが分かりやすい

**技術的タスク**:
- `internal/config/validator.go` の検証ロジック確認
- URL検証の基準を見直し
- タイムアウトと出力形式の検証改善

**依存関係**: PBI-002

---

### PBI-004: レガー設定ファイルの互換性を改善
**ストーリー**: 既存ユーザーとして、古い形式の設定ファイルも使用できるようにしたい
**優先度**: Medium
**ステータス**: 未着手
**ポイント**: 2

**受入条件**:
- [ ] TestLegacyConfigCompatibility がパス
- [ ] YAMLパースエラーが発生しない
- [ ] レガー設定が新しい形式に正しく変換される

**技術的タスク**:
- `test/integration/config_integration_test.go` 調査
- レガーYAMLフォーマットの確認
- パーサーのエラーハンドリング改善
- 移行パスの実装

**依存関係**: PBI-003

---

### PBI-005: E2Eテストの実行環境を改善
**ストーリー**: 開発者として、簡単にすべてのE2Eテストを実行できるようにしたい
**優先度**: Low
**ステータス**: 未着手
**ポイント**: 2

**受入条件**:
- [ ] すべてのE2Eテストが実行できる
- [ ] バイナリパスの問題が解決
- [ ] CI/CDでの実行が安定

**技術的タスク**:
- MakefileにE2Eテスト用ターゲットを追加
- テスト前のビルドプロセスを自動化
- 相対パス問題の解決

**依存関係**: PBI-001

---

## スプリント計画案

### Sprint 1: 基盤修正（優先度High）
- **期間**: 1日
- **目標**: コア機能のテストを安定化
**対象PBI**:
- PBI-001: E2Eテストのフラグ名不一致を修正
- PBI-002: 設定優先順位の実装を修正

### Sprint 2: 検証改善（優先度Medium）
- **期間**: 1日
- **目標**: 設定システムの堅牢性を向上
**対象PBI**:
- PBI-003: 設定検証ロジックを修正
- PBI-004: レガー設定ファイルの互換性を改善

### Sprint 3: 環境整備（優先度Low）
- **期間**: 0.5日
- **目標**: 開発体験の改善
**対象PBI**:
- PBI-005: E2Eテストの実行環境を改善

## デファインション・オブ・ダン（DoD）

すべてのPBIは以下の条件を満たす必要があります：

1. **テスト**: すべての関連テストがパスする
2. **コード品質**: lintエラーがなく、コードレビュー済み
3. **ドキュメント**: 必要なドキュメントが更新されている
4. **リグレッション**: 既存機能が影響を受けていない
5. **コミット**: クリーンなコミット履歴が作成されている

## リスクと課題

### 高リスク
- 設定システムの修正が既存の動作に影響する可能性
- レガー設定の互換性維持の複雑さ

### 中リスク
- E2Eテストの実行時間が長い
- ローカル環境とCI環境の差異

### 軽減策
- 各修正後に回帰テストを実施
- 段階的なマージ戦略を採用
- テストデータのバックアップを維持

## 成功指標

- [ ] テストスイートの成功率：100%
- [ ] テスト実行時間：現在より20%短縮
- [ ] CI/CDの安定性：95%以上

---
*バックログ作成日：2026-01-10*
*最終更新：2026-01-10*