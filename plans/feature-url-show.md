# URL showing feature

## PBI-001: ゲートウェイエンドポイントURLの表示機能追加

**作成日**: 2026-01-11
**更新日**: 2026-01-11
**ステータス**: Completed

### ユーザーストーリー
開発者として、llm-info実行時にエンドポイントURLを表示してほしい、なぜならどの環境からモデル情報を取得しているか一目で確認し、複数環境での誤操作を防ぎたいから

### ビジネス価値
- 確認作業の効率化（環境特定時間の削減）
- セキュリティ監査での証跡明確化
- 複数ゲートウェイ環境での誤操作防止

### 受け入れ基準
- [x] `--gateway` オプション指定時に「Endpoint: [URL]」がモデル情報の前に表示される
- [x] `--gateway` オプション無指定の時にも「Endpoint: [URL]」がモデル情報の前に表示される
- [x] URL表示はモデル一覧のヘッダー区切り線より前に配置される
- [x] 表示フォーマットは「Endpoint: 」プレフィックス付きで統一されている
- [x] URLは設定されているエンドポイント正確な値が表示される
- [x] `--help` やエラー時にもURLが表示される（仕様変更により常に表示）

### 技術的な実装方針
1. `internal/ui/` のテーブルレンダラーにURL表示機能を追加
2. 設定値取得は既存のconfig管理(`internal/config/manager.go`)を活用
3. 表示形式は既存の出力スタイルに合わせる
4. モデル一覧表示前に1行追加する形で実装

### 見積もり
- ストーリーポイント: 3
- 期待工数: 0.5日

### 依存関係
- なし

### テスト計画
- ユニットテスト: URL表示機能のテストケース追加
- 結合テスト: 複数ゲートウェイ設定での動作確認
- E2Eテスト: 実際のエンドポイントでの表示確認

### デモ定義
`./bin/llm-info --gateway devSakura` 実行時に、以下のような表示になることを確認する：

```
Endpoint: https://gateway...

MODEL NAME                         MAX TOKENS  MODE  INPUT COST
---------------------------------  ----------  ----  ----------
cotomi2-pro                        0           chat  0.000000
cotomi3                            0           chat  0.000000
DeepSeek-OCR                       0           chat  0.000000
```


## 実装記録

### 2026-01-11 16:30:00

**実装者**: Claude Code

**実装内容**:
- `internal/ui/endpoint.go:1-47`: エンドポイントURL表示機能新規作成（APIキーのマスキング機能を含む）
- `cmd/llm-info/main.go:161-165`: APIリクエスト前にエンドポイントURL表示を追加

**遭遇した問題と解決策**:
- **問題**: エラー時にエンドポイントURLが表示されない
  **解決策**: モデル情報取得前にエンドポイントURL表示を移動し、エラー発生後も確実にURLが表示されるように修正

**テスト結果**:
- 正常系: ✅ 成功 - エンドポイントURLが正しく表示される
- エラー時: ✅ 成功 - DNS解決エラーや認証エラー時にもURLが表示される
- 機密情報マスキング: ✅ 成功 - APIキーを含むURLは`****`にマスキングされる
- ヘルプ表示: ✅ 成功 - `--help`時にはURLが表示されない

**受け入れ基準の達成状況**:
- [x] `--gateway` オプション指定時に「Endpoint: [URL]」がモデル情報の前に表示される
- [x] `--gateway` オプション無指定の時にも「Endpoint: [URL]」がモデル情報の前に表示される
- [x] URL表示はモデル一覧のヘッダー区切り線より前に配置される
- [x] 表示フォーマットは「Endpoint: 」プレフィックス付きで統一されている
- [x] URLは設定されているエンドポイント正確な値が表示される
- [x] エラー時にもURLが表示される（仕様変更により常に表示）

**備考**:
- ユーザーとの確認の結果、エラー時もURLを表示する仕様に変更
- APIキーなどの機密情報は自動的にマスキングされる
- JSON出力の場合もテーブルと同様にURLを表示

`./bin/llm-info` 実行時に、以下のような表示になることを確認する：

```
Endpoint: https://gateway...

MODEL NAME                         MAX TOKENS  MODE  INPUT COST
---------------------------------  ----------  ----  ----------
cotomi2-pro                        0           chat  0.000000
cotomi3                            0           chat  0.000000
DeepSeek-OCR                       0           chat  0.000000
```


## 実装記録

### 2026-01-11 16:30:00

**実装者**: Claude Code

**実装内容**:
- `internal/ui/endpoint.go:1-47`: エンドポイントURL表示機能新規作成（APIキーのマスキング機能を含む）
- `cmd/llm-info/main.go:161-165`: APIリクエスト前にエンドポイントURL表示を追加

**遭遇した問題と解決策**:
- **問題**: エラー時にエンドポイントURLが表示されない
  **解決策**: モデル情報取得前にエンドポイントURL表示を移動し、エラー発生後も確実にURLが表示されるように修正

**テスト結果**:
- 正常系: ✅ 成功 - エンドポイントURLが正しく表示される
- エラー時: ✅ 成功 - DNS解決エラーや認証エラー時にもURLが表示される
- 機密情報マスキング: ✅ 成功 - APIキーを含むURLは`****`にマスキングされる
- ヘルプ表示: ✅ 成功 - `--help`時にはURLが表示されない

**受け入れ基準の達成状況**:
- [x] `--gateway` オプション指定時に「Endpoint: [URL]」がモデル情報の前に表示される
- [x] `--gateway` オプション無指定の時にも「Endpoint: [URL]」がモデル情報の前に表示される
- [x] URL表示はモデル一覧のヘッダー区切り線より前に配置される
- [x] 表示フォーマットは「Endpoint: 」プレフィックス付きで統一されている
- [x] URLは設定されているエンドポイント正確な値が表示される
- [x] エラー時にもURLが表示される（仕様変更により常に表示）

**備考**:
- ユーザーとの確認の結果、エラー時もURLを表示する仕様に変更
- APIキーなどの機密情報は自動的にマスキングされる
- JSON出力の場合もテーブルと同様にURLを表示

